{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Deleting Logs{% endblock %}

{% block content %}
<h2>Deleting Logs</h2>
<p>Deleting logs for Client Config ID: {{ client_config_id }}</p>

<div style="border: 1px solid #ccc; width: 100%; height: 30px; margin-top: 20px;">
  <div id="progress-bar" style="background: green; width: 0%; height: 100%; color: white; text-align: center;">0%</div>
</div>

<script>
  const clientId = "{{ client_config_id }}";

  async function fetchProgress() {
    try {
      const res = await fetch(`/admin/opcua_mgr/progress-status/${clientId}/`);
      const data = await res.json();
      const percent = data.percent || 0;

      const bar = document.getElementById("progress-bar");
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";

      if (percent < 100) {
        setTimeout(fetchProgress, 1000);
      } else {
        alert("Deletion complete!");
      }
    } catch (err) {
      console.error("Error fetching progress:", err);
    }
  }

  fetchProgress();
</script>
{% endblock %}
